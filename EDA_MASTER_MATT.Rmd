---
title: "R Notebook"
output:
  html_document: default
  HTML: default
---

#### Clear Environment

```{r}
rm(list = ls())
```

#### Load Libraries

```{r}
library(tidyverse)
library(dplyr)
options(dplyr.summarise.inform = FALSE)
library(readxl) 
library(stringr) # string formatting
library(RSQLite) # to connect to SQlite database
library(roxygen2) # For Function Documentation: ctrl + option + shift + r
library(corrplot)
library(ggcorrplot)
library(radiant.data)
library(glue) # to format strings
```

## Load SQLite Database

Create a connection to our new database, CraigslistCars.sqlite3

```{r}
#set path to the database.
db_path <- "CraigslistCarsClean.sqlite3"
  
conn <- dbConnect(RSQLite::SQLite(), db_path)
```

#### List of available tables available in the database

```{r}
dbListTables(conn)
```

Create DFs called "cars" and "census"

```{r}
cars_db <- dbGetQuery(conn, "SELECT * FROM cars_clean")
census_db <- dbGetQuery(conn, "SELECT * FROM census_clean")
dbDisconnect(conn)
```

Create a copy of the Database query so we don't need to re-query each time you want to rerun code.
```{r}
cars <- cars_db
census <- census_db
```

Convert 'state' column to upper case and convert 'posting_date' to DT
```{r}
cars$state <- str_to_upper(cars$state)
cars$posting_date <- as.POSIXct(cars$posting_date)
```

Create single city average from Census data to so we can join to cars
```{r}
census_grouped <- census %>% 
  group_by(city, state) %>% 
  summarise(med_family_income = mean(median_income_family),
            med_non_family_income = mean(median_income_non_family))
```

Get Avg Med income by state
```{r}
census_avg_by_state <- census %>% 
  group_by(state) %>% 
  summarise(med_family_income = mean(median_income_family),
            med_non_family_income = mean(median_income_non_family))
```


#### Change City / State columns are character type for merge
```{r}
cars$state <- as.character(str_trim(cars$state))
cars$city <- as.character(str_trim(cars$city))

census_grouped$city <- as.character(str_trim(census_grouped$city))
census_grouped$state <- as.character(str_trim(census_grouped$state))
```


Merge 'cars' and 'census'
```{r}
cars <- cars %>% left_join(census_grouped, by = c("state", "city")) 
```


```{r}
non_city <- cars  %>% filter(is.na(med_family_income)) %>% select(!c(med_family_income, med_non_family_income))

non_city <- non_city %>% left_join(census_avg_by_state, by = "state")

non_city %>% filter(is.na(med_family_income))
```
```{r}
cars <- cars %>% filter(!is.na(med_family_income))
dim(cars)
```


```{r}
cars <- rbind(cars, non_city)
```

```{r}
cars %>% filter(is.na(med_family_income))
```


```{r}
Odometer_Filter <- function (df, start_year, mileage, remove_na = TRUE) {

  df <- df %>% filter(!is.na(odometer))
  
  mileage_filter <- (df$year <= start_year & df$odometer < mileage)
  df <- df %>% filter(!mileage_filter)
          
  return(df)
  
#' Title: odometer_filter 
#'
#' @param df - dataframe
#' @param start_year - ex: 2018 -> filter out all cars before 2018
#' @param mileage - ex: 500 -> filter out cars with odometer values < 500
#' @param remove_na = TRUE {default}. This removes all NA values from the df
#'
#' @return a dataframe with applied filters
#'
#' @examples odometer_test <- odometer_filter(cars_test, 2018, 500)
  
}
```

```{r}
odometer_test <- Odometer_Filter(cars, 2018, 50)
```

View First 6 Rows of 'cars' df

```{r}
head(cars)
```

#### Create 'age' column
```{r}
cars$age <- 2021 - cars$year
```

Convert 'state', 'manufacturer', 'model' to factor datastructure
```{r}
cars$state <- cars$state %>% factor()
cars$manufacturer <- cars$manufacturer %>% factor()
cars$fuel <- cars$fuel %>% factor()
cars$transmission <- cars$transmission %>% factor()
cars$type <- cars$type %>% factor()
cars$paint_color <- cars$paint_color %>% factor()
cars$drive <- cars$drive %>% factor()
cars$title_status <- cars$title_status %>% factor()
```

Convert 'condition' to ordered factor
```{r}
cars %>% count(condition)
```

```{r}
condition_order <- c('unknown', 'salvage', 'fair', 'good', 'excellent', 'like new', 'new')
cars$condition <- cars$condition %>% factor(levels = condition_order)
```

Clean "cylinder" Variable
```{r}
#- convert to ordered factor data structure
cars %>% count(cylinders)
```

```{r}
cylinder_levels <- c("un", "3", "4", "5", "6", "8", "10", "12")

cars$cylinders <- factor(str_trim(substr(cars$cylinders, start = 1, stop = 2)), levels = cylinder_levels)
cars %>% count(cylinders)
```
Convert Price to Numeric
```{r}
cars$price <- cars$price %>% as.double()
```

Open DF in Radiant for Exploratory Analysis and Modeling
```{r}
#radiant::radiant()
```

```{r}
manuf_bar_plot <- cars %>% 
  group_by(manufacturer) %>% 
  summarise(count = n()) %>% 
  filter(count > 1000) %>% 
  ggplot(aes(x = reorder(manufacturer, (count)), y = count)) + 
    #theme(aspect.ratio = .6) +
    theme(plot.margin = unit(c(.5,.5,.5,.5), "cm")) +
    geom_bar(stat = "identity", width = .5, fill = "cadetblue3") + 
    labs(x = "Manufacturer", y = "Count", title = "Count of Manufacturers") +
    ylim(c(0,80000)) + 
    coord_flip()

ggsave("manuf_count_bar_plot.png", manuf_bar_plot,width = 13, height = 8)
# aspect_ratio <- 2.5
# height <- 9
# ggsave("manuf_bar_plot.png", plot = manuf_bar_plot, width = 7 * aspect_ratio, height = 7, units = "in", dpi = 300)

plot(manuf_bar_plot)
```


```{r}
cars %>% filter(manufacturer == "Ford") %>% 
  count(model)
```


```{r}
ford_models_pattern <- paste(c("Figo", "Fusion Energi", "Focus Electric", "Fiesta", "Endura",
                               "C-Max Hybrid", "B-Max", "Flex", "i-Max", "Fusion", "LCF",
                               "Excursion", "Ikon", "Focus", "Maverick", "Explorer Sport Trac",
                               "Activa", "SportKa", "Freestar", "Territory", "Five Hundred", 
                               "Aspire", "Contour", "Cougar", "Crown Victoria", "Freda", 
                               "Galaxy", "Ka", "Tourneo", "Puma", "Windstar", "ZX2", "F150", 
                               "F-150", "F250", "F-250", "F350", "F-350", "Ranger", "Aerostar",
                               "Bronco", "Bronco II", "Escort", "Probe", "Sierra", "Telstar",
                               "Taurus", "Tempo", "Verona", "Falcon", "F 150", "F 250", "F 350",
                               "F450", "F 450", "F-450", "F750", "F 750", "F-750", "F100", 
                               "F 100", "F-100", "Escape", "Sport Trac", "C Max", 
                               "Thunderbird", "Expedition", "Model B","Model T", "Model Y", 
                               "Model C", "Model A", "Mustang", "Explorer", "Econoline",
                               "Crown Vic", "Transit", "Freestyle", "E350", "E 350", "E-350",
                               "Edge", "F 550", "F-550", "F550", "E150", "E 150", "E-150",
                               "E250", "E 250", "E-250", "E450", "E 450", "E-450",
                               "Ecosport", "F650", "F-650", "F 650", "Raptor", "150", "250",
                               "350", "450"), collapse = "|")

                             
ford <- cars %>%
  filter(manufacturer == "Ford") %>% 
  mutate(model_clean = str_extract(model, regex(pattern = ford_models_pattern, ignore_case = TRUE)))    
```

```{r}
f_150 <- paste(c("F150", "F-150", "F 150", "F-150"), collapse = "|")
f_250 <- paste(c("F250", "F-250", "F 250", "F-250"), collapse = "|")
f_350 <- paste(c("F350", "F-350", "F 350", "F-350"), collapse = "|")
f_450 <- paste(c("F450", "F-450", "F 450", "F-450"), collapse = "|")
f_550 <- paste(c("F550", "F-550", "F 550", "F-550"), collapse = "|")

ford$model_clean <- str_replace_all(ford$model_clean, regex(pattern = f_150), "F-150")
ford$model_clean <- str_replace_all(ford$model_clean, regex(pattern = f_250), "F-250")
ford$model_clean <- str_replace_all(ford$model_clean, regex(pattern = f_350), "F-350")
ford$model_clean <- str_replace_all(ford$model_clean, regex(pattern = f_450), "F-450")
ford$model_clean <- str_replace_all(ford$model_clean, regex(pattern = f_550), "F-550")
```


```{r}
ford <- ford %>% 
  filter(!is.na(model_clean) & price < 100000)
```

```{r}
ford_model_hist <- ford %>% 
  group_by(model_clean) %>% 
  summarise(count = n(), price = price) %>% 
  filter(count > 500) %>% 
  ggplot(aes(x = price, y = model_clean, color = model_clean)) +
  geom_boxplot() +
  labs(title = "Ford Models - Boxplot", y = "Model", x = "Price", color = "Model")
    
  
plot(ford_model_hist)
```



```{r}
ford <- ford %>%
  mutate(model_clean = as.factor(model_clean)) %>% 
  select(city, state, manufacturer, model_clean, year, age, condition, cylinders, fuel, odometer,
         title_status, transmission, drive, type, paint_color,posting_date, price, 
         med_family_income, med_non_family_income) %>% 
  rename(model = model_clean)

```

```{r}
head(ford)
```

#### Clean Chevrolet
```{r}
chevrolet_model_pattern <- paste(c("Bolt", "Cruze", "Menlo", "Onix", "Spark", "Malibu", "Monza", "Optra",
                                   "Sail", "Camaro", "Corvette", "Colorado", "D-Max", "Montana", "S10", "S-10",
                                   "Silverado", "Silverado 1500", "Silverado 2500", "Silverado 2500HD", "Siverado EV", 
                                   "Silverado 3500", "Silverado 3500HD", "Blazer", "Bolt EUV", "Captiva", "Equinox",
                                   "Groove", "Suburban", "Tahoe", "Tracker", "Trailblazer", "Traverse", "Trax",
                                   "Orlando", "Spin", "Express", "Bel Air", "Townsman", "Impala", "El Camino",
                                   "Nova", "Chevelle", "Caprice", "Monte Carlo", "Astro", "Lumina", "Venture",
                                   "Avalanche", "Cobalt", "Volt", "Sonic", "Cavalier", "Elcamino", "1500", "2500",
                                   "3500", "Z71", "Z 71", "Z-71", "Aveo", "C10", "Uplander", "C1500", "C2500", "C3500",
                                   "C4500", "C5500", "C6500", "C7500", "Corvair", "Hhr"), collapse = "|")

chevrolet <- cars %>%
  filter(manufacturer == "Chevrolet") %>% 
  mutate(model_clean = str_extract(model, regex(pattern = chevrolet_model_pattern, ignore_case = TRUE)))  
```


```{r}
chevrolet %>% count(model_clean)
```

```{r}
silverado <- paste(c("1500", "2500", "3500", "Z 71", "Z71", "Silverado"), collapse = "|")

chevrolet$model_clean <- str_replace_all(chevrolet$model_clean, regex(pattern = silverado, ignore_case = TRUE), "Silverado")
chevrolet$model_clean <- str_to_title(chevrolet$model_clean)

chevrolet <- chevrolet %>% filter(!is.na(model_clean)) %>% 
  mutate(model_clean = as.factor(model_clean)) %>% 
  select(city, state, manufacturer, model_clean, year, age, condition, cylinders, fuel, odometer,
         title_status, transmission, drive, type, paint_color, posting_date, price, 
         med_family_income, med_non_family_income) %>% 
  rename(model = model_clean)

```

```{r}
head(chevrolet)
```
#### Clean Toyota Models
```{r}
toyota_model_pattern <- paste(c("Avalon", "Belta", "Camry", "Century", "Corolla", "Crown", "Etios", "Mirai", "Prius",
                                 "Vios", "Yaris", "Agya", "Aqua", "Glanza", "Passo", "4Runner", "4 Runner", "Aygo", "bZ4X",
                                 "C-HR", "FJ Cruiser", "Fortuner", "Harrier", "Venza", "Land Cruiser", "Raize", "Rav4",
                                 "Wildlander", "Rush", "Sequoia", "Urban Cruiser", "Alphard", "Avanza", "Veloz", "Calya",
                                 "Voxy", "Noah", "Roomy", "Rumion", "Sienna", "Verso", "Sienta", "HiAce", "ProAce",
                                 "Hilux", "Tacoma", "Tundra", "GR86", "Supra", "Pixis", "Coaster", "Dyna", "Sora",
                                 "Celica", "Highlander", "Previa", "Solara", "Echo", "Landcruiser", "Rav 4", "Matrix",
                                 "Tercel"), collapse = "|")

toyota <- cars %>%
  filter(manufacturer == "Toyota") %>% 
  mutate(model_clean = str_extract(model, regex(pattern = toyota_model_pattern, ignore_case = TRUE)))  
```

```{r}
toyota %>% count(model_clean)
```

```{r}
a_4runner <- paste(c("4 Runner", "4Runner"), collapse = "|")
landcruiser <- paste(c("Land Cruiser", "Landcruiser"), collapse = "|")
rav4 <- paste(c("Rav 4", "Rav4"), collapse = "|")

toyota$model_clean <- str_replace_all(toyota$model_clean, regex(pattern = a_4runner, ignore_case = TRUE), "4Runner")
toyota$model_clean <- str_replace_all(toyota$model_clean, regex(pattern = landcruiser, ignore_case = TRUE), "Landcruiser")
toyota$model_clean <- str_replace_all(toyota$model_clean, regex(pattern = rav4, ignore_case = TRUE), "RAV4")

toyota$model_clean <- str_to_title(toyota$model_clean)

toyota <- toyota %>% filter(!is.na(model_clean)) %>% 
  mutate(model_clean = as.factor(model_clean)) %>% 
  select(city, state, manufacturer, model_clean, year, age, condition, cylinders, fuel, odometer,
         title_status, transmission, drive, type, paint_color, posting_date, price, 
         med_family_income, med_non_family_income) %>% 
  rename(model = model_clean)
```

#### Clean up Honda

```{r}
honda_model_pattern <- paste(c("Brio", "City", "Civic", "e", "Fit", "Jazz", "Life", "Accord", "Amaze", "CRZ", "CR Z", "CR-Z",
                               "Insight", "Envix", "Crider", "Elysion", "Freed", "Mobilio", "Odyssey", "Clarity",
                               "Shuttle", "Stepwgn", "Avancier", "BR-V", "Breeze", "CRV", "CR-V", "CR V", "Passport",
                               "Pilot", "UR-V", "URV", "WR-V", "WRV", "HRV", "HR V", "HR-V", "Ridgeline", "Civic Type R", "NSX",
                               "S660", "S2000", "Crosstour", "Jade", "Prelude", "Concerto"), collapse = "|")

honda <- cars %>%
  filter(manufacturer == "Honda") %>% 
  mutate(model_clean = str_extract(model, regex(pattern = honda_model_pattern, ignore_case = TRUE))) 
  
honda$model_clean <- str_to_title(honda$model_clean)
```

```{r}
crv <- paste(c("CRV", "CR-V", "CR V"), collapse = "|")
crz <- paste(c("CRZ", "CR-Z", "CR Z"), collapse = "|")
hrv <- paste(c("HRV", "HR V", "HR-V"), collapse = "|")

honda$model_clean <- str_replace_all(honda$model_clean, regex(pattern = crv, ignore_case = TRUE), "CR-V")
honda$model_clean <- str_replace_all(honda$model_clean, regex(pattern = crz, ignore_case = TRUE), "CR-Z")
honda$model_clean <- str_replace_all(honda$model_clean, regex(pattern = hrv, ignore_case = TRUE), "HR-V")
```

```{r}
honda$model_clean <- str_to_title(honda$model_clean)

honda <- honda %>% filter(!is.na(model_clean)) %>% 
  mutate(model_clean = as.factor(model_clean)) %>% 
  select(city, state, manufacturer, model_clean, year, age, condition, cylinders, fuel, odometer,
         title_status, transmission, drive, type, paint_color, posting_date, price, 
         med_family_income, med_non_family_income) %>% 
  rename(model = model_clean)
```


```{r}
honda %>% count(model)
```

#### Clean Ram
```{r}
cars %>% filter(manufacturer == "Ram") %>% count(model)
```


```{r}
ram_model_pattern <- paste(c("1500 Promaster", "2500 Promaster", "3500 Promaster", 
                             "Promaster", "Promaster City", "Chassis", "Cargo Van", 
                             "4500", "5500", "1500 Bighorn", "2500 Bighorn", "3500 Bighorn", 
                             "1500 Laramie", "2500 Laramie", "3500 Laramie", "1500 Rebel", 
                             "1500 Longhorn", "2500 Longhorn", "3500 Longhorn", "1500 Outdoorsman", 
                             "2500 Outdoorsman", "3500 Outdoorsman", "Dakota", "3500", "2500", "1500", "700", "500"), collapse = "|")

ram <- cars %>%
  filter(manufacturer == "Ram") %>% 
  mutate(model_clean = str_extract(model, regex(pattern = ram_model_pattern, ignore_case = TRUE))) 
  
ram$model_clean <- str_to_title(ram$model_clean)
```

```{r}
ram$model_clean <- str_to_title(ram$model_clean)

ram <- ram %>% filter(!is.na(model_clean)) %>% 
  mutate(model_clean = as.factor(model_clean)) %>% 
  select(city, state, manufacturer, model_clean, year, age, condition, cylinders, fuel, odometer,
         title_status, transmission, drive, type, paint_color, posting_date, price, 
         med_family_income, med_non_family_income) %>% 
  rename(model = model_clean)
```

```{r}
ram %>% count(model)
```

```{r}
top_5_manufacturers <- rbind(ford, chevrolet, toyota, honda, ram)
top_5_manufacturers <- top_5_manufacturers %>% arrange(posting_date)
```





#### Create new SQLite DB with top-5 manufacturers
```{r}
conn <- dbConnect(RSQLite::SQLite(), "Top_5_Manufacturers.sqlite")
dbListTables(conn)
```


```{r}
dbWriteTable(conn, "Top_5_Manufacturers", top_5_manufacturers, overwrite = TRUE)
dbListTables(conn)
```


```{r}
dbDisconnect(conn)
```



```{r}
head(ford)
```




# Everything below needs to be checked.
```{r}
#' Title: Model_Box
#'
#' @param input_manufacturer {string}
#'
#' @return: box plot
#' @export: box plot
#'
#' @examples: Model_Box("Ford")
#' 
#' 
Model_Box <- function(input_manufacturer){
  
  # Connect to the database
  conn <- dbConnect(RSQLite::SQLite(), db_path)
  df <- dbGetQuery(conn, glue("SELECT model_clean, price
                               FROM {input_manufacturer}"))
  # Close db connection
  dbDisconnect(conn)
  
  # Build box plots
  model_box <- df %>% 
    group_by(model_clean) %>% 
    summarise(count = n(), price = price) %>%
    # Filter out vehicles that have limited number of observations
    filter(count > 500) %>% 
    ggplot(aes(x = price, y = model_clean, color = model_clean)) +
    geom_boxplot() +
    labs(title = glue("{input_manufacturer} Models - Boxplot"), 
         y = "Model", 
         x = "Price", 
         color = "Model")
  
  # Return Plot
  plot(model_box)
  
}
```

```{r}
Model_Box("Ford")
```

#### Create a function to predict prices for Ford models based on a series of inputs:
- state
- manufacturer
- model
- year
- odometer
- condition

```{r}
#' Title: Model_Prediction
#'
#' @param input_state {string}
#' @param input_city {string}
#' @param input_manufacturer {string} 
#' @param model {string}
#' @param year {int}
#' @param odometer {int}
#' @param input_condition {string} 
#' @param drive {string}
#' @param cylinders {string}
#'
#' @return
#' @export
#'
#' @examples
#' 
Model_Prediction <- function(input_state, input_city, input_manufacturer, model, 
                             year, odometer, input_condition, drive, cylinders) {
  
  # Connect to db and create df based on input_manufacturer
  conn <- dbConnect(RSQLite::SQLite(), db_path)
  df <- dbGetQuery(conn, glue("SELECT state, city, manufacturer, model_clean, age, condition, 
                                      odometer, drive, cylinders, price, med_family_income, med_non_family_income
                               FROM {input_manufacturer}"))
  # Close db connection
  dbDisconnect(conn)
  
  # Create a df filtered by input state, manufacturer, and model
  df <- df %>%
    filter(state == input_state, 
           manufacturer == input_manufacturer, 
           model_clean == model,
           condition == input_condition
    )
  
  # Extract income values for model 
  med_inc <- df %>% filter(state == input_state, city == input_city)
  med_inc_fam <- med_inc$med_family_income[1]
  med_inc_non_fam <- med_inc$med_non_family_income[1]
  
  # Create linear model
  lm_model <- lm(price ~ age + odometer + drive + cylinders + med_family_income + med_non_family_income, data = df)
  
  # Create new data point from user inputs
  newData <- data.frame(model_clean = model,
                        age = 2021 - year,
                        odometer = odometer,
                        drive = drive,
                        cylinders = cylinders,
                        med_family_income = med_inc_fam,
                        med_non_family_income = med_inc_non_fam)
  
  # Create list of objects to return as list
  number_of_observations <- paste("Number of Training Observations = ", nrow(df))
  model_summary <- summary(lm_model)
  predictions <- predict(lm_model, newdata = newData, interval = "confidence", level = .95)
  
  
  return(list(number_of_observations, model_summary, predictions))
  
}

```

#### Test 'ford_prediction' Function
```{r}
Model_Prediction("CA", "Sacramento", "Ford", "F-250", 2015, 100000, "good", "4wd", "8")
```


#Creating New Variable Price/Odometer, we do later, just testing git rn - Shawn

#Clean cylinder variable

```{r}
#ifelse(apply(str_contains(cars$cylinders,"cylinders",ignore.case=FALSE)), substring(cars$cylinders,1,1),0)
cars_clean <- cars %>% mutate(cylinders_clean=as.integer(str_extract(cars$cylinders,'[0-9]')))
glimpse(cars_clean)
```

#Creating New Variable Price/Odometer

```{r}
#change price type to mutate new column for new variable
cars_clean$price <- as.double(cars_clean$price)
#mutate new variable
cars_clean_pm <- cars_clean %>% mutate(pm = cars$price/cars$odometer)
glimpse(cars_clean_pm)
```

#select only numeric columns for correlation matrix
```{r}
car_num <- select_if(cars,is.numeric)
head(car_num)
```

#correlation matrix for collinearity check

```{r}
cars_clean_pm$fuel <- as.factor(cars_clean_pm$fuel)
cars_clean_pm$title_status <- as.factor(cars_clean_pm$title_status)
cars_clean_pm$transmission <- as.factor(cars_clean_pm$transmission)
cars_sub <- select(cars_clean_pm,year,cylinders_clean,fuel,odometer,title_status,transmission,price)
glimpse(cars_sub)
model.matrix(~0+., data=cars_sub) %>%
  cor(use="pairwise.complete.obs") %>%
  ggcorrplot(show.diag=F,type="full",lab=TRUE, lab_size = 2,ggtheme = ggplot2::theme_gray(),colors = c("#6D9EC1", "white", "#E46726"),tl.srt=90, tl.cex=8, hc.order=TRUE, insig="blank")
# car_num <- select_if(cars,is.numeric)
# head(car_num)
# correl <- cor(car_num[-1])
# corrplot(correl,addCoef.col = 'black')

```

#Create Linear Regression Model, test

```{r}
cars$price <- as.double(cars$price)
lin <- lm(price ~ year + odometer, data = cars)
summary(lin)
```

**Comment** Per result tested on linear regression model above, we can see odometer which has p=0.9 that is greater than typical significant value p=0.05. Thus, it might be not a relevant variable to use.

#plot scatter/residual plots to spot non-linearity and outliers/high-leverage points

```{r}
plot(lin,which=1:5)
```

#plot price trends in different states of USA

```{r}
price_trend <- cars %>% group_by(state) %>%summarize(average_price=mean(price))
ggplot(price_trend, aes(x=reorder(state,-log(average_price)),y=log(average_price))) + geom_bar(stat="identity",fill="steelblue") + labs(x="state") 
```

#Plot box-plot to detect outliers/influential points across US states

```{r}
ggplot(cars,aes(x=state,y=log(price))) + geom_boxplot(fill="steelblue")
```

#Market share of TOP 10 manufacturers

```{r}
top_10 <- cars %>% group_by(manufacturer) %>% summarize(count=n()) %>% arrange(desc(count)) %>% top_n(10)
top_10
ggplot(top_10,aes(x=reorder(manufacturer,-count),y=count)) + geom_bar(stat='identity',fill='steelblue') + labs(x="Manufacturer")
```

#Type of car and fuel

```{r}
car_type <- cars %>% group_by(fuel,type) %>% summarize(count=n()) %>% arrange(desc(count)) %>% top_n(10)
car_type
ggplot(car_type,aes(fill=fuel,x=reorder(type,-count),y=count)) + geom_bar(stat="identity",position="stack")
```

#Condition vs Year relationship

```{r}
ggplot(cars,aes(x=year,y=condition)) + geom_violin(scale='area',fill='steelblue') + geom_boxplot(width=0.1,colors='grey',alpha=0.2)
```

#Odometer vs Price relationship

```{r}
ggplot(cars, aes(x=log(odometer),y=log(price)*1000,color=year))+geom_point() + labs(x='odometer',y='price') 
```

